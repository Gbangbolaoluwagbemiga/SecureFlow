(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[323],{147:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>I});var r=s(3365),a=s(1521),i=s(8600),n=s(7408),o=s(6782),l=s(740),c=s(6745),d=s(1941),m=s(150),u=s(4086),p=s(6102),h=s(5096),x=s(919),b=s(627),f=s(6170),g=s(7812),j=s(2770),v=s(7674),N=s(9386),y=s(9703);function w(e){let{formData:t,onUpdate:s,isContractPaused:a,errors:i={}}=e;return(0,r.jsxs)(f.Zp,{className:"glass border-primary/20 p-6",children:[(0,r.jsx)(f.aR,{children:(0,r.jsx)(f.ZB,{children:"Project Details"})}),(0,r.jsxs)(f.Wu,{className:"space-y-6",children:[a&&(0,r.jsxs)(N.Fc,{variant:"destructive",children:[(0,r.jsx)(y.A,{className:"h-4 w-4"}),(0,r.jsx)(N.TN,{children:"Contract is currently paused. Escrow creation is temporarily disabled."})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(j.J,{htmlFor:"projectTitle",children:"Project Title *"}),(0,r.jsx)(g.p,{id:"projectTitle",value:t.projectTitle,onChange:e=>s({projectTitle:e.target.value}),placeholder:"Enter project title",required:!0,minLength:3,className:i.projectTitle?"border-red-500 focus:border-red-500":""}),i.projectTitle&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:i.projectTitle})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(j.J,{htmlFor:"duration",children:"Duration (days) *"}),(0,r.jsx)(g.p,{id:"duration",type:"number",value:t.duration,onChange:e=>s({duration:e.target.value}),placeholder:"e.g., 30",min:"1",max:"365",required:!0,className:i.duration?"border-red-500 focus:border-red-500":""}),i.duration&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:i.duration})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(j.J,{htmlFor:"projectDescription",children:"Project Description *"}),(0,r.jsx)(v.T,{id:"projectDescription",value:t.projectDescription,onChange:e=>s({projectDescription:e.target.value}),placeholder:"Describe the project requirements and deliverables...",className:"min-h-[120px] ".concat(i.projectDescription?"border-red-500 focus:border-red-500":""),required:!0,minLength:50}),i.projectDescription?(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:i.projectDescription}):(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Minimum 50 characters required"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(j.J,{htmlFor:"totalBudget",children:"Total Budget (tokens) *"}),(0,r.jsx)(g.p,{id:"totalBudget",type:"number",value:t.totalBudget,onChange:e=>s({totalBudget:e.target.value}),placeholder:"e.g., 1000",min:"0.01",step:"0.01",required:!0,className:i.totalBudget?"border-red-500 focus:border-red-500":""}),i.totalBudget?(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:i.totalBudget}):(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Minimum 0.01 tokens required"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)(j.J,{htmlFor:"beneficiary",children:["Beneficiary Address ",!t.isOpenJob&&"*"]}),(0,r.jsx)(g.p,{id:"beneficiary",value:t.beneficiary,onChange:e=>s({beneficiary:e.target.value}),placeholder:"0x...",disabled:t.isOpenJob,required:!t.isOpenJob,pattern:"^0x[a-fA-F0-9]{40}$",className:i.beneficiary?"border-red-500 focus:border-red-500":""}),i.beneficiary?(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:i.beneficiary}):(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:t.isOpenJob?"Leave empty for open job applications":"Valid Ethereum address required for direct escrow"})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("input",{type:"checkbox",id:"useNativeToken",checked:t.useNativeToken,onChange:e=>s({useNativeToken:e.target.checked}),className:"rounded"}),(0,r.jsx)(j.J,{htmlFor:"useNativeToken",children:"Use Native Token (MON)"})]}),!t.useNativeToken&&(0,r.jsxs)("div",{children:[(0,r.jsx)(j.J,{htmlFor:"tokenAddress",children:"Token Address *"}),(0,r.jsx)(g.p,{id:"tokenAddress",value:t.token,onChange:e=>s({token:e.target.value}),placeholder:"0x...",required:!t.useNativeToken,pattern:"^0x[a-fA-F0-9]{40}$",className:i.tokenAddress?"border-red-500 focus:border-red-500":""}),i.tokenAddress?(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:i.tokenAddress}):(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Enter the contract address of your ERC20 token deployed on Monad Testnet"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("input",{type:"checkbox",id:"isOpenJob",checked:t.isOpenJob,onChange:e=>s({isOpenJob:e.target.checked}),className:"rounded"}),(0,r.jsx)(j.J,{htmlFor:"isOpenJob",children:"Open Job (Allow Applications)"})]})]})]})]})}var k=s(2699),T=s(7521),C=s(3060),E=s(6009),F=s(2196),A=s(1892),B=s(6441);function M(e){let{onResult:t,onClose:s,currentMilestoneIndex:n,existingMilestones:o}=e,{toast:c}=(0,l.dj)(),[d,m]=(0,a.useState)(""),[h,x]=(0,a.useState)([]),[b,g]=(0,a.useState)(!1),N=async()=>{if(!d.trim()){c({title:"Enter a prompt",description:"Please describe what you need for this milestone",variant:"destructive"});return}g(!0),setTimeout(()=>{x(["Complete ".concat(d," with comprehensive documentation and testing. Deliverables include source code, test cases, and deployment guide."),"Develop and implement ".concat(d," following best practices. Includes code review, unit tests, and integration with existing systems."),"Design and build ".concat(d," with focus on scalability and performance. Deliverables include architecture diagrams, implementation, and performance benchmarks.")]),g(!1)},1500)},y=e=>{navigator.clipboard.writeText(e),c({title:"Copied to clipboard",description:"Milestone description copied successfully"})},w=e=>{if(null!==n){let s=[...o];s[n]={...s[n],description:e},t(s)}else t([...o,{description:e,amount:""}]);c({title:"Milestone updated",description:"AI-generated description has been added to your milestone"})};return(0,r.jsxs)(f.Zp,{className:"glass border-accent/20 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,r.jsx)(k.A,{className:"h-5 w-5 text-accent"}),(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"AI Milestone Writer"}),(0,r.jsx)(E.E,{variant:"outline",className:"ml-auto",children:(0,r.jsx)("span",{className:"text-xs",children:"Beta"})}),(0,r.jsx)(i.$,{variant:"ghost",size:"sm",onClick:s,className:"ml-2 h-8 w-8 p-0",children:(0,r.jsx)(F.A,{className:"h-4 w-4"})})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(j.J,{htmlFor:"ai-prompt",children:"Describe your milestone"}),(0,r.jsx)(v.T,{id:"ai-prompt",placeholder:"e.g., frontend development for user dashboard",value:d,onChange:e=>m(e.target.value),rows:3})]}),(0,r.jsx)(i.$,{onClick:N,disabled:b,className:"w-full gap-2",children:b?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(A.A,{className:"h-4 w-4 animate-spin"}),"Generating..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(k.A,{className:"h-4 w-4"}),"Generate Descriptions"]})}),(0,r.jsx)(p.N,{children:h.length>0&&(0,r.jsxs)(u.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-3",children:[(0,r.jsx)(j.J,{children:"AI Suggestions"}),h.map((e,t)=>(0,r.jsx)(u.P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1*t},children:(0,r.jsxs)(f.Zp,{className:"p-4 border-muted hover:border-primary/50 transition-colors",children:[(0,r.jsx)("p",{className:"text-sm leading-relaxed mb-3",children:e}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(i.$,{onClick:()=>w(e),size:"sm",variant:"default",className:"gap-2",children:"Use This"}),(0,r.jsxs)(i.$,{onClick:()=>y(e),size:"sm",variant:"outline",className:"gap-2",children:[(0,r.jsx)(B.A,{className:"h-3 w-3"}),"Copy"]})]})]})},t))]})})]})]})}function D(e){let{milestones:t,onUpdate:s,showAIWriter:a,onToggleAIWriter:n,currentMilestoneIndex:o,onSetCurrentMilestoneIndex:l,totalBudget:c,errors:d={}}=e,m=e=>{t.length>1&&s(t.filter((t,s)=>s!==e))},u=(e,r,a)=>{let i=[...t];i[e]={...i[e],[r]:a},s(i)};return(0,r.jsxs)(f.Zp,{className:"glass border-primary/20 p-6",children:[(0,r.jsx)(f.aR,{children:(0,r.jsx)(f.ZB,{children:"Milestones"})}),(0,r.jsxs)(f.Wu,{className:"space-y-4",children:[a&&(0,r.jsx)(M,{onResult:e=>{s(e),n(!1),l(null)},onClose:()=>{n(!1),l(null)},currentMilestoneIndex:o,existingMilestones:t}),t.map((e,s)=>(0,r.jsxs)("div",{className:"border border-border/40 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("h4",{className:"font-medium",children:["Milestone ",s+1]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(i.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{l(s),n(!0)},children:[(0,r.jsx)(k.A,{className:"h-4 w-4 mr-1"}),"AI Writer"]}),t.length>1&&(0,r.jsx)(i.$,{type:"button",variant:"outline",size:"sm",onClick:()=>m(s),children:(0,r.jsx)(T.A,{className:"h-4 w-4"})})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(j.J,{htmlFor:"milestone-".concat(s,"-description"),children:"Description *"}),(0,r.jsx)(v.T,{id:"milestone-".concat(s,"-description"),value:e.description,onChange:e=>u(s,"description",e.target.value),placeholder:"Describe what needs to be delivered...",className:"min-h-[80px] ".concat(d.milestones?"border-red-500 focus:border-red-500":""),required:!0,minLength:10}),d.milestones?(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:d.milestones}):(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Minimum 10 characters required"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(j.J,{htmlFor:"milestone-".concat(s,"-amount"),children:"Amount (tokens) *"}),(0,r.jsx)(g.p,{id:"milestone-".concat(s,"-amount"),type:"number",value:e.amount,onChange:e=>u(s,"amount",e.target.value),placeholder:"e.g., 500",min:"0.01",step:"0.01",required:!0,className:d.milestones?"border-red-500 focus:border-red-500":""}),d.milestones?(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:d.milestones}):(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Minimum 0.01 tokens required"})]})]})]},s)),(0,r.jsxs)(i.$,{type:"button",variant:"outline",onClick:()=>{s([...t,{description:"",amount:""}])},className:"w-full",children:[(0,r.jsx)(C.A,{className:"h-4 w-4 mr-2"}),"Add Milestone"]}),(0,r.jsxs)("div",{className:"mt-6 p-4 bg-muted/50 rounded-lg border",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(j.J,{className:"text-sm font-medium text-muted-foreground",children:"Total Milestone Amount:"}),(0,r.jsx)("div",{className:"text-2xl font-bold text-primary",children:t.reduce((e,t)=>e+(Number.parseFloat(t.amount)||0),0).toFixed(2)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(j.J,{className:"text-sm font-medium text-muted-foreground",children:"Target Total:"}),(0,r.jsx)("div",{className:"text-2xl font-bold text-foreground",children:c||"0.00"})]})]}),d.totalMismatch&&(0,r.jsxs)("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded-md",children:[(0,r.jsx)("p",{className:"text-red-600 text-sm font-medium",children:"Amount mismatch"}),(0,r.jsx)("p",{className:"text-red-500 text-sm",children:d.totalMismatch})]})]})]})]})}var P=s(6414),S=s(8760),O=s(7931),J=s(5655);function R(e){let{formData:t,onConfirm:s,isSubmitting:a,isContractPaused:i}=e,{isSmartAccountReady:n}=(0,o.y)(),l=t.milestones.reduce((e,t)=>e+Number.parseFloat(t.amount||"0"),0),c=.01>Math.abs(l-Number.parseFloat(t.totalBudget));return(0,r.jsxs)(f.Zp,{className:"glass border-primary/20 p-6",children:[(0,r.jsx)(f.aR,{children:(0,r.jsx)(f.ZB,{children:"Review & Confirm"})}),(0,r.jsxs)(f.Wu,{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-lg mb-2",children:t.projectTitle}),(0,r.jsx)("p",{className:"text-muted-foreground",children:t.projectDescription})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(P.A,{className:"h-4 w-4 text-muted-foreground"}),(0,r.jsxs)("span",{className:"text-sm",children:[t.duration," days"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(S.A,{className:"h-4 w-4 text-muted-foreground"}),(0,r.jsxs)("span",{className:"text-sm",children:[t.totalBudget," tokens"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(O.A,{className:"h-4 w-4 text-muted-foreground"}),(0,r.jsx)("span",{className:"text-sm",children:t.isOpenJob?"Open Job":"Direct Assignment"})]})]}),t.beneficiary&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Beneficiary:"}),(0,r.jsx)("p",{className:"font-mono text-sm",children:t.beneficiary})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"font-medium mb-2",children:["Milestones (",t.milestones.length,")"]}),(0,r.jsx)("div",{className:"space-y-2",children:t.milestones.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-2 bg-muted/20 rounded",children:[(0,r.jsx)("span",{className:"text-sm",children:e.description}),(0,r.jsxs)("span",{className:"text-sm font-medium",children:[e.amount," tokens"]})]},t))})]}),(0,r.jsxs)("div",{className:"border-t pt-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"font-medium",children:"Total Milestone Amount:"}),(0,r.jsxs)("span",{className:"font-semibold",children:[l.toFixed(2)," tokens"]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"font-medium",children:"Project Budget:"}),(0,r.jsxs)("span",{className:"font-semibold",children:[t.totalBudget," tokens"]})]}),!c&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-2",children:"⚠️ Milestone amounts don't match project budget"})]})]}),(0,r.jsx)("div",{className:"flex gap-4",children:(0,r.jsx)("button",{type:"button",onClick:s,disabled:a||i||!c,className:"flex-1 bg-primary text-primary-foreground px-6 py-3 rounded-lg font-medium hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:a?"Creating Escrow...":n?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(J.A,{className:"h-4 w-4"}),"Create Gasless Escrow"]}):"Create Escrow"})})]})]})}function I(){let e=(0,b.useRouter)(),{wallet:t,getContract:f}=(0,n.$)(),{executeTransaction:g,isSmartAccountReady:j}=(0,o.y)(),{toast:v}=(0,l.dj)(),[N,y]=(0,a.useState)(1),[k,T]=(0,a.useState)(!1),[C,E]=(0,a.useState)(!1),[F,A]=(0,a.useState)(null),[B,M]=(0,a.useState)(!1),[P,S]=(0,a.useState)(!1),[O,J]=(0,a.useState)(!1),[I,q]=(0,a.useState)({});(0,a.useEffect)(()=>{W()},[]);let W=async()=>{try{let e=f(h.oB.SECUREFLOW_ESCROW,x.f),t=await e.call("paused"),s=!1;if(!0===t||"true"===t||1===t)s=!0;else if(!1===t||"false"===t||0===t)s=!1;else if(t&&"object"==typeof t)try{let e=t.toString();s="true"===e||"1"===e}catch(e){s=!1}J(s)}catch(e){J(!1)}},[$,_]=(0,a.useState)({projectTitle:"",projectDescription:"",duration:"",totalBudget:"",beneficiary:"",token:h.cF,useNativeToken:!1,isOpenJob:!1,milestones:[{description:"",amount:""},{description:"",amount:""}]});h.cF;let L=()=>$.milestones.reduce((e,t)=>e+(Number.parseFloat(t.amount)||0),0),G=()=>{let e={},t=!1;if(1===N)(!$.projectTitle||$.projectTitle.length<3)&&(e.projectTitle="Project title must be at least 3 characters",t=!0),(!$.projectDescription||$.projectDescription.length<50)&&(e.projectDescription="Project description must be at least 50 characters",t=!0),(!$.duration||1>Number($.duration)||Number($.duration)>365)&&(e.duration="Duration must be between 1 and 365 days",t=!0),(!$.totalBudget||.01>Number($.totalBudget))&&(e.totalBudget="Total budget must be at least 0.01 tokens",t=!0),$.isOpenJob||$.beneficiary&&/^0x[a-fA-F0-9]{40}$/.test($.beneficiary)||(e.beneficiary="Valid beneficiary address is required for direct escrow",t=!0),$.useNativeToken||$.token&&/^0x[a-fA-F0-9]{40}$/.test($.token)||(e.tokenAddress="Valid token address is required for custom ERC20 tokens",t=!0);else if(2===N){let s=L(),r=Number.parseFloat($.totalBudget)||0;$.milestones.some(e=>!e.description||!e.amount)&&(e.milestones="Please fill in all milestone details",t=!0),Math.abs(s-r)>.01&&(e.totalMismatch="Milestone amounts (".concat(s,") must equal total amount (").concat(r,")"),t=!0)}return q(e),!t},U=()=>{q({})},Y=()=>{let e=[];(!$.projectTitle||$.projectTitle.length<3)&&e.push("Project title must be at least 3 characters long"),(!$.projectDescription||$.projectDescription.length<50)&&e.push("Project description must be at least 50 characters long"),(!$.duration||1>Number($.duration)||Number($.duration)>365)&&e.push("Duration must be between 1 and 365 days"),(!$.totalBudget||.01>Number($.totalBudget))&&e.push("Total budget must be at least 0.01 tokens"),$.isOpenJob||($.beneficiary?/^0x[a-fA-F0-9]{40}$/.test($.beneficiary)||e.push("Beneficiary address must be a valid Ethereum address"):e.push("Beneficiary address is required for direct escrow")),0===$.milestones.length&&e.push("At least one milestone is required");for(let t=0;t<$.milestones.length;t++){let s=$.milestones[t];(!s.description||s.description.length<10)&&e.push("Milestone ".concat(t+1," description must be at least 10 characters long")),(!s.amount||.01>Number(s.amount))&&e.push("Milestone ".concat(t+1," amount must be at least 0.01 tokens"))}return Math.abs($.milestones.reduce((e,t)=>e+Number(t.amount||0),0)-Number($.totalBudget))>.01&&e.push("Total milestone amounts must equal the total budget"),e},Z=async()=>{if(!t.isConnected){v({title:"Wallet not connected",description:"Please connect your wallet to create an escrow",variant:"destructive"});return}let r=Y();if(r.length>0){v({title:"Form validation failed",description:r.join(", "),variant:"destructive"});return}if(!$.token){v({title:"Invalid token address",description:"Please select a token type",variant:"destructive"});return}T(!0);try{let r;if($.token!==h.cF){let e=f($.token,x.i),s=BigInt(Math.floor(1e18*Number.parseFloat($.totalBudget))).toString();try{await e.call("name"),await e.call("symbol"),await e.call("decimals")}catch(e){throw Error("Token contract is not working properly. Please check the token address.")}try{let r=await e.call("balanceOf",t.address);if(Number(r)<Number(s))throw Error("Insufficient token balance. You have ".concat((Number(r)/1e18).toFixed(2)," tokens but need ").concat($.totalBudget," tokens."))}catch(e){throw Error("Failed to check token balance. Please ensure you have enough tokens or try using native MON tokens instead.")}await e.send("approve","no-value",h.oB.SECUREFLOW_ESCROW,s),v({title:"Approval submitted",description:"Waiting for token approval confirmation..."}),await new Promise(e=>setTimeout(e,2e3))}let a=f(h.oB.SECUREFLOW_ESCROW,x.f),i=$.milestones.map(e=>e.description),n=P?"0x0000000000000000000000000000000000000000":$.beneficiary||"0x0000000000000000000000000000000000000000";if($.token===h.cF){let e=BigInt(Math.floor(1e18*Number.parseFloat($.totalBudget))).toString();try{let s=await window.ethereum.request({method:"eth_getBalance",params:[t.address]}),r=BigInt(s),a=BigInt(e);if(r<a)throw Error("Insufficient MON balance. You have ".concat((Number(r)/1e18).toFixed(4)," MON but need ").concat($.totalBudget," MON."))}catch(e){throw Error("Failed to check MON balance. Please ensure you have enough MON tokens.")}let o=$.milestones.map(e=>BigInt(Math.floor(1e18*Number.parseFloat(e.amount))).toString()),l=["0x3be7fbbdbc73fc4731d60ef09c4ba1a94dc58e41"],c=86400*Number($.duration),d=0;for(;d<3;)try{await a.estimateGas("createEscrowNative",e,n,l,1,o,i,c,$.projectTitle,$.projectDescription);break}catch(e){if(++d>=3){BigInt(5e5);break}await new Promise(e=>setTimeout(e,1e3))}let m=0;for(;m<3;)try{if(j){let{ethers:t}=await s.e(416).then(s.bind(s,2416)),a=new t.Interface(x.f).encodeFunctionData("createEscrowNative",[n,l,1,o,i,c,$.projectTitle,$.projectDescription]);r=await g(h.oB.SECUREFLOW_ESCROW,a,(Number(e)/1e18).toString()),v({title:"\uD83D\uDE80 Gasless Escrow Created!",description:"Escrow created with no gas fees using Smart Account delegation"})}else r=await a.send("createEscrowNative","0x".concat(BigInt(e).toString(16)),n,l,1,o,i,c,$.projectTitle,$.projectDescription),v({title:"Escrow Created!",description:"Your escrow has been created successfully"});break}catch(t){if(++m>=3)throw t;let e=1e3*Math.pow(2,m);await new Promise(t=>setTimeout(t,e))}}else{let e=["0x3be7fbbdbc73fc4731d60ef09c4ba1a94dc58e41"],t=$.milestones.map(e=>BigInt(Math.floor(1e18*Number.parseFloat(e.amount))).toString()),o=86400*Number($.duration);if(j){let{ethers:a}=await s.e(416).then(s.bind(s,2416)),l=new a.Interface(x.f).encodeFunctionData("createEscrow",[n,e,1,t,i,$.token,o,$.projectTitle,$.projectDescription]);r=await g(h.oB.SECUREFLOW_ESCROW,l,"0"),v({title:"\uD83D\uDE80 Gasless ERC20 Escrow Created!",description:"ERC20 escrow created with no gas fees using Smart Account delegation"})}else r=await a.send("createEscrow","no-value",n,e,1,t,i,$.token,o,$.projectTitle,$.projectDescription),v({title:"ERC20 Escrow Created!",description:"Your ERC20 escrow has been created successfully"})}if(j){let t;let s=0;for(;s<30;){try{if(t=await window.ethereum.request({method:"eth_getTransactionReceipt",params:[r]}))break}catch(e){}await new Promise(e=>setTimeout(e,2e3)),s++}if(!t)throw Error("Transaction timeout - please check the blockchain explorer");if("0x1"===t.status)v({title:P?"\uD83D\uDE80 Gasless Job Posted!":"\uD83D\uDE80 Gasless Escrow Created!",description:P?"Your job is now live with no gas fees! Freelancers can apply on the Browse Jobs page.":"Your escrow has been created successfully with no gas fees! The freelancer can now start working."}),setTimeout(()=>{e.push(P?"/jobs":"/dashboard")},2e3);else throw Error("Transaction failed on blockchain")}else{let t;let s=0;for(;s<30;){try{if(t=await window.ethereum.request({method:"eth_getTransactionReceipt",params:[r]}))break}catch(e){}await new Promise(e=>setTimeout(e,2e3)),s++}if(!t)throw Error("Transaction timeout - please check the blockchain explorer");if("0x1"===t.status)v({title:P?"Job posted!":"Escrow created!",description:P?"Your job is now live. Freelancers can apply on the Browse Jobs page.":"Your escrow has been successfully created"}),setTimeout(()=>{e.push(P?"/jobs":"/dashboard")},2e3);else throw Error("Transaction failed on blockchain")}}catch(t){var a,i,n,o,l,c,d;let e="Failed to create escrow";v({title:"Creation failed",description:(null===(a=t.message)||void 0===a?void 0:a.includes("insufficient funds"))?"Insufficient funds. Please check your balance.":(null===(i=t.message)||void 0===i?void 0:i.includes("gas"))?"Gas estimation failed. Please try again.":(null===(n=t.message)||void 0===n?void 0:n.includes("revert"))?"Transaction reverted. Please check your parameters.":(null===(o=t.message)||void 0===o?void 0:o.includes("user rejected"))?"Transaction was rejected by user.":(null===(l=t.message)||void 0===l?void 0:l.includes("timeout"))?"Transaction timeout. Please try again.":(null===(c=t.message)||void 0===c?void 0:c.includes("Internal JSON-RPC error"))?"Network error occurred. Please try again - this usually works on the second attempt.":-32603===t.code?"RPC error occurred. Please try again - this usually works on the second attempt.":t.message||"Failed to create escrow",variant:"destructive"}),((null===(d=t.message)||void 0===d?void 0:d.includes("Internal JSON-RPC error"))||-32603===t.code)&&setTimeout(()=>{v({title:"\uD83D\uDCA1 Tip",description:"This is a common network issue. Please try creating the escrow again - it usually works on the second attempt!",variant:"default"})},2e3)}finally{T(!1)}};return(0,r.jsx)("div",{className:"min-h-screen py-12 gradient-mesh",children:(0,r.jsx)("div",{className:"container mx-auto px-4 max-w-4xl",children:(0,r.jsxs)(u.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[(0,r.jsx)("h1",{className:"text-4xl md:text-5xl font-bold mb-4 text-center",children:"Create New Escrow"}),(0,r.jsx)("p",{className:"text-xl text-muted-foreground text-center mb-12",children:"Set up a secure escrow with milestone-based payments"}),(0,r.jsx)("div",{className:"flex items-center justify-center mb-12",children:(0,r.jsx)("div",{className:"flex items-center gap-4",children:[1,2,3].map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:"flex items-center justify-center w-10 h-10 rounded-full border-2 transition-all ".concat(e===N?"border-primary bg-primary text-primary-foreground":e<N?"border-primary bg-primary/20 text-primary":"border-muted-foreground/30 text-muted-foreground"),children:e<N?(0,r.jsx)(c.A,{className:"h-5 w-5"}):e}),e<3&&(0,r.jsx)("div",{className:"w-16 h-0.5 ".concat(e<N?"bg-primary":"bg-muted-foreground/30")})]},e))})}),(0,r.jsxs)(p.N,{mode:"wait",children:[1===N&&(0,r.jsx)(u.P.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},children:(0,r.jsx)(w,{formData:$,onUpdate:e=>{_({...$,...e}),U()},isContractPaused:O,errors:{projectTitle:I.projectTitle,projectDescription:I.projectDescription,duration:I.duration,totalBudget:I.totalBudget,beneficiary:I.beneficiary,tokenAddress:I.tokenAddress}})},"step1"),2===N&&(0,r.jsx)(u.P.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},children:(0,r.jsx)(D,{milestones:$.milestones,onUpdate:e=>{_({...$,milestones:e}),U()},showAIWriter:C,onToggleAIWriter:E,currentMilestoneIndex:F,onSetCurrentMilestoneIndex:A,totalBudget:$.totalBudget,errors:{milestones:I.milestones,totalMismatch:I.totalMismatch}})},"step2"),3===N&&(0,r.jsx)(u.P.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},children:(0,r.jsx)(R,{formData:$,onConfirm:Z,isSubmitting:k,isContractPaused:O})},"step3")]}),(0,r.jsxs)("div",{className:"flex justify-between mt-8",children:[(0,r.jsxs)(i.$,{type:"button",variant:"outline",onClick:()=>{y(N-1)},disabled:1===N,className:"flex items-center gap-2",children:[(0,r.jsx)(d.A,{className:"h-4 w-4"}),"Previous"]}),(0,r.jsxs)(i.$,{type:"button",onClick:()=>{G()&&y(N+1)},disabled:3===N,className:"flex items-center gap-2",children:["Next",(0,r.jsx)(m.A,{className:"h-4 w-4"})]})]})]})})})}},391:(e,t,s)=>{Promise.resolve().then(s.bind(s,147))},2770:(e,t,s)=>{"use strict";s.d(t,{J:()=>c});var r=s(3365),a=s(1521),i=s(301),n=s(2934),o=s(9671);let l=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(i.b,{ref:t,className:(0,o.cn)(l(),s),...a})});c.displayName=i.b.displayName},7674:(e,t,s)=>{"use strict";s.d(t,{T:()=>n});var r=s(3365),a=s(1521),i=s(9671);let n=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...a})});n.displayName="Textarea"},7812:(e,t,s)=>{"use strict";s.d(t,{p:()=>i});var r=s(3365);s(1521);var a=s(9671);function i(e){let{className:t,type:s,...i}=e;return(0,r.jsx)("input",{type:s,"data-slot":"input",className:(0,a.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...i})}},9386:(e,t,s)=>{"use strict";s.d(t,{Fc:()=>l,TN:()=>d,XL:()=>c});var r=s(3365),a=s(1521),i=s(2934),n=s(9671);let o=(0,i.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),l=a.forwardRef((e,t)=>{let{className:s,variant:a,...i}=e;return(0,r.jsx)("div",{ref:t,role:"alert",className:(0,n.cn)(o({variant:a}),s),...i})});l.displayName="Alert";let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("h5",{ref:t,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",s),...a})});c.displayName="AlertTitle";let d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",s),...a})});d.displayName="AlertDescription"}},e=>{var t=t=>e(e.s=t);e.O(0,[202,315,902,898,654,347,870,358],()=>t(391)),_N_E=e.O()}]);