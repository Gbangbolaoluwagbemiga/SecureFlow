(()=>{var e={};e.id=105,e.ids=[105],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4030:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});let i=(0,s(33922).A)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11423:(e,t,s)=>{Promise.resolve().then(s.bind(s,49874))},14449:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});let i=(0,s(33922).A)("Gavel",[["path",{d:"m14.5 12.5-8 8a2.119 2.119 0 1 1-3-3l8-8",key:"15492f"}],["path",{d:"m16 16 6-6",key:"vzrcl6"}],["path",{d:"m8 8 6-6",key:"18bi4p"}],["path",{d:"m9 7 8 8",key:"5jnvq1"}],["path",{d:"m21 11-8-8",key:"z4y7zo"}]])},16866:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});let i=(0,s(33922).A)("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]])},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},19819:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>d});var i=s(5853),a=s(60554),r=s(30708),n=s.n(r),o=s(8067),l={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);s.d(t,l);let d={children:["",{children:["dashboard",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,49874)),"/home/oluwagbemiga/Desktop/Hackathons/Solidity/frontend/frontend/app/dashboard/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,97898)),"/home/oluwagbemiga/Desktop/Hackathons/Solidity/frontend/frontend/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,92192,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,82137,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,48358,23)),"next/dist/client/components/unauthorized-error"]}]}.children,c=["/home/oluwagbemiga/Desktop/Hackathons/Solidity/frontend/frontend/app/dashboard/page.tsx"],u={require:s,loadChunk:()=>Promise.resolve()},m=new i.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/dashboard/page",pathname:"/dashboard",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},29395:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});let i=(0,s(33922).A)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},41274:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});let i=(0,s(33922).A)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},49874:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});let i=(0,s(20413).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/oluwagbemiga/Desktop/Hackathons/Solidity/frontend/frontend/app/dashboard/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/oluwagbemiga/Desktop/Hackathons/Solidity/frontend/frontend/app/dashboard/page.tsx","default")},53483:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>ei});var i=s(28625),a=s(64996),r=s(55136),n=s(22167),o=s(20702),l=s(5950),d=s(97861),c=s(76812),u=s(400),m=s(93683),p=s(82825),h=s(47887),x=s(86493),f=s(79344),b=s(19205),v=s(22154);function w(){return(0,i.jsx)(v.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,i.jsxs)("div",{className:"mb-8",children:[(0,i.jsx)("h1",{className:"text-4xl md:text-5xl font-bold mb-2",children:"Dashboard"}),(0,i.jsx)("p",{className:"text-xl text-muted-foreground",children:"Manage your escrows and track your projects"})]})})}function g({escrows:e}){let t=e.reduce((e,t)=>e+Number.parseFloat(t.totalAmount)/1e18,0),s=e.reduce((e,t)=>e+Number.parseFloat(t.releasedAmount)/1e18,0),a=e=>e.milestones.some(e=>"disputed"===e.status||"rejected"===e.status),n=e.filter(e=>"active"===e.status&&!a(e)).length;e.filter(e=>"completed"===e.status).length;let o=e.filter(e=>"disputed"===e.status||a(e)).length;return(0,i.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-8",children:[(0,i.jsxs)(r.Zp,{className:"glass border-primary/20 p-4 md:p-6",children:[(0,i.jsxs)(r.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,i.jsx)(r.ZB,{className:"text-sm font-medium",children:"Total Value"}),(0,i.jsx)(m.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,i.jsxs)(r.Wu,{children:[(0,i.jsx)("div",{className:"text-2xl font-bold",children:t.toFixed(2)}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:"tokens in escrows"})]})]}),(0,i.jsxs)(r.Zp,{className:"glass border-accent/20 p-4 md:p-6",children:[(0,i.jsxs)(r.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,i.jsx)(r.ZB,{className:"text-sm font-medium",children:"Released"}),(0,i.jsx)(f.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,i.jsxs)(r.Wu,{children:[(0,i.jsx)("div",{className:"text-2xl font-bold",children:s.toFixed(2)}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:"tokens released"})]})]}),(0,i.jsxs)(r.Zp,{className:"glass border-primary/20 p-4 md:p-6",children:[(0,i.jsxs)(r.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,i.jsx)(r.ZB,{className:"text-sm font-medium",children:"Active"}),(0,i.jsx)(p.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,i.jsxs)(r.Wu,{children:[(0,i.jsx)("div",{className:"text-2xl font-bold",children:n}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:"projects"})]})]}),(0,i.jsxs)(r.Zp,{className:"glass border-primary/20 p-4 md:p-6",children:[(0,i.jsxs)(r.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,i.jsx)(r.ZB,{className:"text-sm font-medium",children:"Disputed"}),(0,i.jsx)(h.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,i.jsxs)(r.Wu,{children:[(0,i.jsx)("div",{className:"text-2xl font-bold",children:o}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:"projects"})]})]})]})}var j=s(55918);function y(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}s(58709);var N=Symbol("radix.slottable");function k(e){return a.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===N}var A=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{let s=function(e){let t=function(e){let t=a.forwardRef((e,t)=>{let{children:s,...i}=e;if(a.isValidElement(s)){var r;let e,n;let o=(r=s,(n=(e=Object.getOwnPropertyDescriptor(r.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?r.ref:(n=(e=Object.getOwnPropertyDescriptor(r,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?r.props.ref:r.props.ref||r.ref),l=function(e,t){let s={...t};for(let i in t){let a=e[i],r=t[i];/^on[A-Z]/.test(i)?a&&r?s[i]=(...e)=>{let t=r(...e);return a(...e),t}:a&&(s[i]=a):"style"===i?s[i]={...a,...r}:"className"===i&&(s[i]=[a,r].filter(Boolean).join(" "))}return{...e,...s}}(i,s.props);return s.type!==a.Fragment&&(l.ref=t?function(...e){return t=>{let s=!1,i=e.map(e=>{let i=y(e,t);return s||"function"!=typeof i||(s=!0),i});if(s)return()=>{for(let t=0;t<i.length;t++){let s=i[t];"function"==typeof s?s():y(e[t],null)}}}}(t,o):o),a.cloneElement(s,l)}return a.Children.count(s)>1?a.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}(e),s=a.forwardRef((e,s)=>{let{children:r,...n}=e,o=a.Children.toArray(r),l=o.find(k);if(l){let e=l.props.children,r=o.map(t=>t!==l?t:a.Children.count(e)>1?a.Children.only(null):a.isValidElement(e)?e.props.children:null);return(0,i.jsx)(t,{...n,ref:s,children:a.isValidElement(e)?a.cloneElement(e,void 0,r):null})}return(0,i.jsx)(t,{...n,ref:s,children:r})});return s.displayName=`${e}.Slot`,s}(`Primitive.${t}`),r=a.forwardRef((e,a)=>{let{asChild:r,...n}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,i.jsx)(r?s:t,{...n,ref:a})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{}),T="Progress",[C,E]=function(e,t=[]){let s=[],r=()=>{let t=s.map(e=>a.createContext(e));return function(s){let i=s?.[e]||t;return a.useMemo(()=>({[`__scope${e}`]:{...s,[e]:i}}),[s,i])}};return r.scopeName=e,[function(t,r){let n=a.createContext(r),o=s.length;s=[...s,r];let l=t=>{let{scope:s,children:r,...l}=t,d=s?.[e]?.[o]||n,c=a.useMemo(()=>l,Object.values(l));return(0,i.jsx)(d.Provider,{value:c,children:r})};return l.displayName=t+"Provider",[l,function(s,i){let l=i?.[e]?.[o]||n,d=a.useContext(l);if(d)return d;if(void 0!==r)return r;throw Error(`\`${s}\` must be used within \`${t}\``)}]},function(...e){let t=e[0];if(1===e.length)return t;let s=()=>{let s=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let i=s.reduce((t,{useScope:s,scopeName:i})=>{let a=s(e)[`__scope${i}`];return{...t,...a}},{});return a.useMemo(()=>({[`__scope${t.scopeName}`]:i}),[i])}};return s.scopeName=t.scopeName,s}(r,...t)]}(T),[P,R]=C(T),S=a.forwardRef((e,t)=>{var s,a;let{__scopeProgress:r,value:n=null,max:o,getValueLabel:l=$,...d}=e;(o||0===o)&&!_(o)&&console.error((s=`${o}`,`Invalid prop \`max\` of value \`${s}\` supplied to \`Progress\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`));let c=_(o)?o:100;null===n||O(n,c)||console.error((a=`${n}`,`Invalid prop \`value\` of value \`${a}\` supplied to \`Progress\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`));let u=O(n,c)?n:null,m=W(u)?l(u,c):void 0;return(0,i.jsx)(P,{scope:r,value:u,max:c,children:(0,i.jsx)(A.div,{"aria-valuemax":c,"aria-valuemin":0,"aria-valuenow":W(u)?u:void 0,"aria-valuetext":m,role:"progressbar","data-state":D(u,c),"data-value":u??void 0,"data-max":c,...d,ref:t})})});S.displayName=T;var M="ProgressIndicator",F=a.forwardRef((e,t)=>{let{__scopeProgress:s,...a}=e,r=R(M,s);return(0,i.jsx)(A.div,{"data-state":D(r.value,r.max),"data-value":r.value??void 0,"data-max":r.max,...a,ref:t})});function $(e,t){return`${Math.round(e/t*100)}%`}function D(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function W(e){return"number"==typeof e}function _(e){return W(e)&&!isNaN(e)&&e>0}function O(e,t){return W(e)&&!isNaN(e)&&e<=t&&e>=0}F.displayName=M;var q=s(36761);let L=a.forwardRef(({className:e,value:t,...s},a)=>(0,i.jsx)(S,{ref:a,className:(0,q.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...s,children:(0,i.jsx)(F,{className:"h-full w-full flex-1 bg-gradient-to-r from-primary to-accent transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));L.displayName=S.displayName;var z=s(41274),I=s(33922);let B=(0,I.A)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),U=(0,I.A)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);var Z=s(61242),G=s(62848),H=s(44595),V=s(16866),Y=s(4030);let J=(0,I.A)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var X=s(14449),K=s(95649),Q=s(29395);function ee({escrowId:e,milestoneIndex:t,milestone:r,isPayer:u,isBeneficiary:m,escrowStatus:h,onSuccess:x,allMilestones:f=[],showSubmitButton:b=!0,payerAddress:v,beneficiaryAddress:w}){let{getContract:g}=(0,n.$)(),{executeTransaction:y,executeBatchTransaction:N,isSmartAccountReady:k}=(0,G.y)(),{isDelegatedFunction:A}=(0,H.k)(),{addNotification:T,addCrossWalletNotification:C}=(0,c.E$)(),{toast:E}=(0,o.dj)(),[P,R]=(0,a.useState)(!1),[S,M]=(0,a.useState)(!1),[F,$]=(0,a.useState)(null),[D,W]=(0,a.useState)(""),[_,O]=(0,a.useState)(""),q=f.some(e=>"disputed"===e.status||"rejected"===e.status),L=async e=>{let t=0;for(;t<30;){try{let t=await window.ethereum.request({method:"eth_getTransactionReceipt",params:[e]});if(t)return t}catch(e){}await new Promise(e=>setTimeout(e,2e3)),t++}throw Error("Transaction timeout - please check the blockchain explorer")},z=()=>"submitted"===r.status&&u,I=e=>{$(e),W(""),O(""),M(!0)},B=async()=>{if(("dispute"===F||"reject"===F)&&!D.trim()){E({title:"Reason required",description:`Please provide a reason for ${"dispute"===F?"disputing":"rejecting"} this milestone`,variant:"destructive"});return}R(!0);try{let i;let a=g(l.oB.SECUREFLOW_ESCROW,d.f),n=k&&("approve"===F||"submit"===F||"dispute"===F);switch(A("approve"===F?"approveMilestone":"dispute"===F?"disputeMilestone":""),F){case"start":i=await a.send("startWork",e),E({title:"Work started!",description:"You can now begin working on the milestones"}),C((0,c.xg)("work_started",e,{projectTitle:`Project #${e}`,freelancerName:"Freelancer"}),v,w);break;case"submit":if(n){let{ethers:a}=await s.e(363).then(s.bind(s,363)),n=new a.Interface(d.f).encodeFunctionData("submitMilestone",[e,t,r.description]);i=await y(l.oB.SECUREFLOW_ESCROW,n),E({title:"\uD83D\uDE80 Gasless Milestone Submitted!",description:"Milestone submitted with no gas fees using Smart Account delegation"}),C((0,c.A0)("submitted",e,t),v,w)}else i=await a.send("submitMilestone","no-value",e,t,r.description),E({title:"Milestone submitted!",description:"Waiting for client approval"}),C((0,c.A0)("submitted",e,t),v,w);await new Promise(e=>setTimeout(e,2e3)),x();break;case"approve":try{if("submitted"!==r.status){E({title:"Invalid milestone state",description:"This milestone is not in submitted state and cannot be approved",variant:"destructive"});return}if(n){let{ethers:a}=await s.e(363).then(s.bind(s,363)),r=new a.Interface(d.f).encodeFunctionData("approveMilestone",[e,t]);i=await y(l.oB.SECUREFLOW_ESCROW,r),E({title:"\uD83D\uDE80 Gasless Milestone Approved!",description:"Milestone approved with no gas fees using Smart Account delegation"})}else{try{await a.estimateGas("approveMilestone",e,t)}catch(e){console.log("Gas estimation failed, proceeding with transaction")}let s=0;for(;s<3;)try{i=await a.send("approveMilestone","no-value",e,t);break}catch(e){if(++s>=3)throw e;await new Promise(e=>setTimeout(e,2e3)),E({title:"Retrying transaction",description:`Attempt ${s+1} of 3. Please wait...`,variant:"default"})}}try{let s;if(s=i&&"function"==typeof i.wait?await Promise.race([i.wait(),new Promise((e,t)=>setTimeout(()=>t(Error("Transaction timeout")),6e4))]):await L(i),1===s.status)E({title:"Milestone approved!",description:"Payment has been released to the beneficiary"}),C((0,c.A0)("approved",e,t),v,w),M(!1),await new Promise(e=>setTimeout(e,5e3)),window.dispatchEvent(new CustomEvent("milestoneApproved",{detail:{escrowId:e,milestoneIndex:t}})),x(),await new Promise(e=>setTimeout(e,2e3)),window.location.reload(),window.location.reload();else throw Error("Transaction failed on blockchain")}catch(s){if(i){E({title:"Milestone approved!",description:"Payment has been released to the beneficiary"}),M(!1),await new Promise(e=>setTimeout(e,5e3)),window.dispatchEvent(new CustomEvent("milestoneApproved",{detail:{escrowId:e,milestoneIndex:t}})),x(),await new Promise(e=>setTimeout(e,2e3)),window.location.reload();return}if(s.message?.includes("timeout"))E({title:"Transaction timeout",description:"The transaction is taking longer than expected. Please check the blockchain explorer to see if it was successful.",variant:"destructive"});else throw Error("Transaction failed to confirm on blockchain")}}catch(e){throw e.message?.includes("Not submitted")?E({title:"Transaction failed",description:"The transaction was not submitted to the network. This may be due to network congestion or wallet issues. Please try again or refresh the page.",variant:"destructive"}):e.message?.includes("Transaction failed on blockchain")?E({title:"Transaction reverted",description:"The transaction was submitted but failed on the blockchain. The milestone may not be in the correct state for approval.",variant:"destructive"}):e.message?.includes("insufficient funds")?E({title:"Insufficient funds",description:"You don't have enough MON tokens to pay for the transaction fee.",variant:"destructive"}):e.message?.includes("gas")?E({title:"Gas estimation failed",description:"Unable to estimate gas for this transaction. The milestone may not be in the correct state.",variant:"destructive"}):E({title:"Approval failed",description:e.message||"An unexpected error occurred while approving the milestone.",variant:"destructive"}),e}finally{R(!1)}break;case"reject":try{if("submitted"!==r.status){E({title:"Invalid milestone state",description:"This milestone is not in submitted state and cannot be rejected",variant:"destructive"});return}if(n){let{ethers:a}=await s.e(363).then(s.bind(s,363)),r=new a.Interface(d.f).encodeFunctionData("rejectMilestone",[e,t,D]);i=await y(l.oB.SECUREFLOW_ESCROW,r),E({title:"\uD83D\uDE80 Smart Account Milestone rejected!",description:"Milestone rejected using Smart Account with enhanced features"})}else i=await a.send("rejectMilestone","no-value",e,t,D);try{let s;if(s=i&&"function"==typeof i.wait?await Promise.race([i.wait(),new Promise((e,t)=>setTimeout(()=>t(Error("Transaction timeout")),6e4))]):await L(i),1===s.status)E({title:"Milestone rejected!",description:"The milestone has been rejected and the freelancer can resubmit"}),C((0,c.A0)("rejected",e,t,{reason:D}),v,w),M(!1),x(),await new Promise(e=>setTimeout(e,2e3)),window.location.reload();else throw Error("Transaction failed on blockchain")}catch(e){if(i){E({title:"Milestone rejected!",description:"The milestone has been rejected and the freelancer can resubmit"}),M(!1),x(),await new Promise(e=>setTimeout(e,2e3)),window.location.reload();return}throw Error("Transaction failed to confirm on blockchain")}}catch(e){E({title:"Rejection failed",description:e.message||"Failed to reject milestone",variant:"destructive"});return}finally{R(!1)}break;case"resubmit":try{if("rejected"!==r.status){E({title:"Invalid milestone state",description:"This milestone is not in rejected state and cannot be resubmitted",variant:"destructive"});return}if(n){let{ethers:a}=await s.e(363).then(s.bind(s,363)),n=new a.Interface(d.f).encodeFunctionData("resubmitMilestone",[e,t,_||r.description]);i=await y(l.oB.SECUREFLOW_ESCROW,n),E({title:"\uD83D\uDE80 Smart Account Milestone resubmitted!",description:"Milestone resubmitted using Smart Account with enhanced features"})}else i=await a.send("resubmitMilestone","no-value",e,t,_||r.description);try{let s;if(s=i&&"function"==typeof i.wait?await Promise.race([i.wait(),new Promise((e,t)=>setTimeout(()=>t(Error("Transaction timeout")),6e4))]):await L(i),1===s.status)E({title:"Milestone resubmitted!",description:"The milestone has been resubmitted and is waiting for client review"}),C((0,c.A0)("submitted",e,t),v,w),M(!1),x();else throw Error("Transaction failed on blockchain")}catch(e){if(i){E({title:"Milestone resubmitted!",description:"The milestone has been resubmitted and is waiting for client review"}),M(!1),x();return}throw Error("Transaction failed to confirm on blockchain")}}catch(e){E({title:"Resubmission failed",description:e.message||"Failed to resubmit milestone",variant:"destructive"});return}finally{R(!1)}break;case"dispute":try{if("submitted"!==r.status){E({title:"Invalid milestone state",description:"This milestone is not in submitted state and cannot be disputed",variant:"destructive"});return}if(n){let{ethers:a}=await s.e(363).then(s.bind(s,363)),r=new a.Interface(d.f).encodeFunctionData("disputeMilestone",[e,t,D]);i=await y(l.oB.SECUREFLOW_ESCROW,r),E({title:"\uD83D\uDE80 Smart Account Dispute created!",description:"Dispute created using Smart Account with enhanced features"}),C((0,c.A0)("disputed",e,t,{reason:D}),v,w)}else i=await a.send("disputeMilestone","no-value",e,t,D);if(!i)throw Error("No transaction hash received - transaction may have failed");try{let s;if(s=i&&"function"==typeof i.wait?await Promise.race([i.wait(),new Promise((e,t)=>setTimeout(()=>t(Error("Transaction timeout")),6e4))]):await L(i),1===s.status)E({title:"Milestone disputed!",description:"The milestone has been disputed and will be reviewed by the admin"}),M(!1),await new Promise(e=>setTimeout(e,5e3)),window.dispatchEvent(new CustomEvent("milestoneDisputed",{detail:{escrowId:e,milestoneIndex:t}})),x(),await new Promise(e=>setTimeout(e,2e3)),window.location.reload();else throw Error("Transaction failed on blockchain")}catch(s){if(i){E({title:"Milestone disputed!",description:"The milestone has been disputed and will be reviewed by the admin"}),M(!1),await new Promise(e=>setTimeout(e,5e3)),window.dispatchEvent(new CustomEvent("milestoneDisputed",{detail:{escrowId:e,milestoneIndex:t}})),x(),await new Promise(e=>setTimeout(e,2e3)),window.location.reload();return}throw s.message?.includes("timeout")?E({title:"Transaction timeout",description:"The transaction is taking longer than expected. Please check the blockchain explorer to see if it was successful.",variant:"destructive"}):E({title:"Transaction failed",description:"The transaction failed to confirm on the blockchain.",variant:"destructive"}),s}}catch(e){throw e.message?.includes("Gas estimation failed")?E({title:"Transaction failed",description:"Gas estimation failed. The milestone may not be in the correct state for dispute.",variant:"destructive"}):e.message?.includes("Internal JSON-RPC error")?E({title:"Transaction failed",description:"Network error occurred. Please try again or check your connection.",variant:"destructive"}):E({title:"Dispute failed",description:e.message||"An unexpected error occurred while disputing the milestone.",variant:"destructive"}),e}finally{R(!1)}break;case"resolve":E({title:"Resolution pending",description:"Admin will review and resolve the dispute"})}M(!1),x()}catch(e){E({title:"Action failed",description:e.message||"Failed to perform action",variant:"destructive"})}finally{R(!1)}},U=(()=>{switch(F){case"start":return{title:"Start Work",description:"Confirm that you're ready to start working on this project. This will activate the escrow.",icon:V.A,confirmText:"Start Work"};case"submit":return{title:"Submit Milestone",description:`Submit milestone ${t+1} for review. The client will be notified to approve your work.`,icon:Y.A,confirmText:"Submit"};case"approve":return{title:"Approve Milestone",description:`Approve milestone ${t+1} and release ${(Number.parseFloat(r.amount)/1e18).toFixed(2)} tokens to the beneficiary.`,icon:p.A,confirmText:"Approve & Release"};case"reject":return{title:"Reject Milestone",description:`Reject milestone ${t+1}. The freelancer will be able to resubmit after making changes.`,icon:J,confirmText:"Reject"};case"resubmit":return{title:"Resubmit Milestone",description:`Resubmit milestone ${t+1} for client review. Make sure you've addressed the feedback.`,icon:Y.A,confirmText:"Resubmit"};case"dispute":return{title:"Dispute Milestone",description:`Dispute milestone ${t+1}. This will notify the admin to review the dispute.`,icon:X.A,confirmText:"Dispute"};case"resolve":return{title:"Resolve Dispute",description:"As the contract owner, you can resolve this dispute in favor of either party.",icon:X.A,confirmText:"Resolve"};default:return{title:"",description:"",icon:p.A,confirmText:"Confirm"}}})(),ee=U.icon;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"flex flex-wrap gap-2","data-milestone-actions":`${e}-${t}`,children:[b&&(()=>{if("pending"!==r.status||!m||"active"!==h)return!1;if(0===t)return!0;let e=f[t-1];if(!e)return!1;let s="approved"===e.status,i=!1;for(let e=0;e<t;e++){let t=f[e];if(t&&"submitted"===t.status){i=!0;break}}return s&&!i})()&&!q&&(0,i.jsx)(j.$,{onClick:()=>I("submit"),size:"sm",variant:"default",className:"gap-2",children:k?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(K.A,{className:"h-4 w-4"}),"Smart Submit"]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Y.A,{className:"h-4 w-4"}),"Submit"]})}),z()&&!q&&(0,i.jsx)(j.$,{onClick:()=>I("approve"),size:"sm",variant:"default",className:"gap-2",disabled:P,children:k?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(K.A,{className:"h-4 w-4"}),P?"Processing...":"Smart Approve"]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(p.A,{className:"h-4 w-4"}),P?"Processing...":"Approve"]})}),z()&&!q&&(0,i.jsx)(j.$,{onClick:()=>I("reject"),size:"sm",variant:"outline",className:"gap-2 border-red-200 text-red-600 hover:bg-red-50 hover:border-red-300",disabled:P,children:k?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(K.A,{className:"h-4 w-4"}),P?"Processing...":"Smart Reject"]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(J,{className:"h-4 w-4"}),P?"Processing...":"Reject"]})}),"submitted"===r.status&&u&&!q&&(0,i.jsx)(j.$,{onClick:()=>I("dispute"),size:"sm",variant:"destructive",className:"gap-2",disabled:P,children:k?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(K.A,{className:"h-4 w-4"}),P?"Processing...":"Smart Dispute"]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(X.A,{className:"h-4 w-4"}),P?"Processing...":"Dispute"]})}),"approved"===r.status&&(0,i.jsxs)("div",{className:"flex items-center gap-2 text-green-600",children:[(0,i.jsx)(p.A,{className:"h-4 w-4"}),(0,i.jsx)("span",{className:"text-sm font-medium",children:"Approved"})]}),"rejected"===r.status&&(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 text-red-600",children:[(0,i.jsx)(Q.A,{className:"h-4 w-4"}),(0,i.jsx)("span",{className:"text-sm font-medium",children:"Rejected"})]}),"rejected"===r.status&&m&&(0,i.jsx)(j.$,{onClick:()=>I("resubmit"),size:"sm",variant:"default",className:"gap-2",disabled:P,"data-action":"resubmit",children:k?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(K.A,{className:"h-4 w-4"}),P?"Processing...":"Smart Resubmit"]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Y.A,{className:"h-4 w-4"}),P?"Processing...":"Resubmit"]})})]}),"disputed"===r.status&&(0,i.jsxs)("div",{className:"flex flex-col gap-2 text-orange-600",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(X.A,{className:"h-4 w-4"}),(0,i.jsx)("span",{className:"text-sm font-medium",children:"Disputed"})]}),r.disputeReason&&(0,i.jsxs)("div",{className:"text-xs text-orange-700 bg-orange-50 p-2 rounded border",children:[(0,i.jsx)("strong",{children:"Reason:"})," ",r.disputeReason]})]}),"resolved"===r.status&&(0,i.jsxs)("div",{className:"flex items-center gap-2 text-blue-600",children:[(0,i.jsx)(p.A,{className:"h-4 w-4"}),(0,i.jsx)("span",{className:"text-sm font-medium",children:"Resolved"})]}),q&&(0,i.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,i.jsx)(Q.A,{className:"h-4 w-4"}),(0,i.jsx)("span",{className:"text-sm font-medium",children:"Project Terminated"})]})]}),(0,i.jsx)(Z.lG,{open:S,onOpenChange:M,children:(0,i.jsxs)(Z.Cf,{className:"glass",children:[(0,i.jsxs)(Z.c7,{children:[(0,i.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,i.jsx)("div",{className:"flex items-center justify-center w-12 h-12 rounded-full bg-primary/10",children:(0,i.jsx)(ee,{className:"h-6 w-6 text-primary"})}),(0,i.jsx)(Z.L3,{className:"text-2xl",children:U.title})]}),(0,i.jsx)(Z.rr,{className:"text-base leading-relaxed",children:U.description})]}),(0,i.jsx)("div",{className:"bg-muted/50 rounded-lg p-4 my-4",children:(0,i.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{className:"text-muted-foreground",children:"Escrow ID:"}),(0,i.jsxs)("span",{className:"font-mono font-semibold",children:["#",e]})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{className:"text-muted-foreground",children:"Milestone:"}),(0,i.jsx)("span",{className:"font-semibold",children:t+1})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{className:"text-muted-foreground",children:"Amount:"}),(0,i.jsx)("span",{className:"font-bold text-primary",children:(()=>{try{let e=Number.parseFloat(r.amount);if(isNaN(e))return"0.00";return(e/1e18).toFixed(2)}catch(e){return"0.00"}})()})]})]})}),("dispute"===F||"reject"===F)&&(0,i.jsxs)("div",{className:"my-4",children:[(0,i.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Reason for ","dispute"===F?"dispute":"rejection"," ","(required)"]}),(0,i.jsx)("textarea",{value:D,onChange:e=>W(e.target.value),placeholder:`Please explain why you are ${"dispute"===F?"disputing":"rejecting"} this milestone...`,className:"w-full p-3 border border-gray-300 rounded-md resize-none focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",rows:3,required:!0}),!D.trim()&&(0,i.jsxs)("p",{className:"text-sm text-red-600 mt-1",children:["Please provide a reason for the"," ","dispute"===F?"dispute":"rejection"]})]}),"resubmit"===F&&(0,i.jsxs)("div",{className:"my-4 space-y-4",children:[r.rejectionReason&&(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-red-600 mb-2",children:"Rejection Reason"}),(0,i.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-sm text-red-800",children:r.rejectionReason})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Update Message"}),(0,i.jsx)("textarea",{value:_,onChange:e=>O(e.target.value),placeholder:"Describe the improvements you've made to address the client's feedback...",className:"w-full p-3 border border-gray-300 rounded-md resize-none focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",rows:4}),(0,i.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"This message will be sent to the client along with your resubmission."})]})]}),(0,i.jsxs)(Z.Es,{children:[(0,i.jsx)(j.$,{variant:"outline",onClick:()=>M(!1),disabled:P,children:"Cancel"}),(0,i.jsx)(j.$,{onClick:B,disabled:P,children:P?"Processing...":U.confirmText})]})]})})]})}function et({escrow:e,index:t,expandedEscrow:s,submittingMilestone:a,onToggleExpanded:n,onApproveMilestone:o,onRejectMilestone:l,onDisputeMilestone:d,onStartWork:c,onDispute:m,calculateDaysLeft:p,getDaysLeftMessage:h}){let x=e.milestones.some(e=>"disputed"===e.status||"rejected"===e.status),f=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"submitted":return"bg-blue-100 text-blue-800";case"approved":return"bg-green-100 text-green-800";case"disputed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},w="0"!==e.totalAmount?Number.parseFloat(e.releasedAmount)/Number.parseFloat(e.totalAmount)*100:0,g=e.milestones.filter(e=>"approved"===e.status).length,y=e.milestones.length;return(0,i.jsx)(v.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.1*t},children:(0,i.jsxs)(r.Zp,{className:"glass border-primary/20 p-4 md:p-6 hover:border-primary/40 transition-colors",children:[(0,i.jsx)(r.aR,{children:(0,i.jsxs)("div",{className:"flex items-start justify-between",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)(r.ZB,{className:"text-lg mb-2",children:e.projectDescription}),(0,i.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsx)(u.A,{className:"h-4 w-4"}),(0,i.jsxs)("span",{children:[Math.round(e.duration/86400)," days"]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsx)(z.A,{className:"h-4 w-4"}),(0,i.jsxs)("span",{children:[(Number.parseFloat(e.totalAmount)/1e18).toFixed(2)," ","tokens"]})]})]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(b.E,{className:(e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"active":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"disputed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(x?"terminated":e.status),children:x?"terminated":e.status}),(0,i.jsx)(j.$,{variant:"ghost",size:"sm",onClick:()=>n(e.id),className:"cursor-pointer",children:s===e.id?(0,i.jsx)(B,{className:"h-4 w-4"}):(0,i.jsx)(U,{className:"h-4 w-4"})})]})]})}),(0,i.jsx)(r.Wu,{children:(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex items-center justify-between text-sm mb-2",children:[(0,i.jsx)("span",{children:"Progress"}),(0,i.jsxs)("span",{children:[g,"/",y," milestones"]})]}),(0,i.jsx)(L,{value:w,className:"h-2"})]}),(0,i.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"text-gray-600",children:"Total Amount:"}),(0,i.jsxs)("div",{className:"font-semibold",children:[(Number.parseFloat(e.totalAmount)/1e18).toFixed(2)," ","tokens"]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"text-gray-600",children:"Released:"}),(0,i.jsxs)("div",{className:"font-semibold",children:[(Number.parseFloat(e.releasedAmount)/1e18).toFixed(2)," ","tokens"]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"text-gray-600",children:"Days Left:"}),(0,i.jsxs)("div",{className:"font-semibold flex items-center gap-1",children:[(0,i.jsx)(u.A,{className:"h-4 w-4"}),(()=>{let t=h(p(e.createdAt,e.duration));return(0,i.jsx)("span",{className:t.color,children:t.text})})()]})]})]}),s===e.id&&(0,i.jsx)("div",{className:"space-y-4 pt-4 border-t",children:(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("h4",{className:"font-medium",children:"Milestones:"}),e.milestones.map((t,s)=>(0,i.jsxs)("div",{className:"flex items-center justify-between p-2 bg-muted/20 rounded",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("p",{className:"text-sm font-medium",children:t.description}),(0,i.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(Number.parseFloat(t.amount)/1e18).toFixed(2)," ","tokens"]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(b.E,{className:f(t.status),children:t.status}),(0,i.jsx)(ee,{escrowId:e.id,milestoneIndex:s,milestone:t,isPayer:e.isClient||!1,isBeneficiary:e.isFreelancer||!1,escrowStatus:e.status,allMilestones:e.milestones,showSubmitButton:!1,payerAddress:e.payer,beneficiaryAddress:e.beneficiary,onSuccess:()=>{window.dispatchEvent(new CustomEvent("escrowUpdated"))}})]})]},s))]})})]})})]})})}function es({isConnected:e}){return e?(0,i.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"inline-block h-12 w-12 animate-spin rounded-full border-4 border-solid border-primary border-r-transparent mb-4"}),(0,i.jsx)("p",{className:"text-muted-foreground",children:"Loading your dashboard..."})]})}):(0,i.jsx)("div",{className:"min-h-screen flex items-center justify-center gradient-mesh",children:(0,i.jsxs)(r.Zp,{className:"glass border-primary/20 p-12 text-center max-w-md",children:[(0,i.jsx)(x.A,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground"}),(0,i.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Wallet Not Connected"}),(0,i.jsx)("p",{className:"text-muted-foreground mb-6",children:"Please connect your wallet to view your dashboard"})]})})}function ei(){let{wallet:e,getContract:t}=(0,n.$)(),{toast:s}=(0,o.dj)(),{addNotification:u,addCrossWalletNotification:m}=(0,c.E$)(),[p,h]=(0,a.useState)([]),[b,v]=(0,a.useState)(!0),[j,y]=(0,a.useState)(null),[N,k]=(0,a.useState)(null),A=e=>{switch(e){case 0:default:return"pending";case 1:case 4:return"active";case 2:return"completed";case 3:return"disputed"}},T=e=>{let t=["pending","submitted","approved","disputed","resolved","rejected"][e]||"pending";return 5===e&&console.log("Milestone status 5 (Rejected) detected"),t},C=(e,t)=>Math.max(0,Math.ceil((e+1e3*t-Date.now())/864e5)),E=e=>e>7?{text:`${e} days`,color:"text-red-700 dark:text-red-400",bgColor:"bg-red-50 dark:bg-red-900/20"}:e>0?{text:`${e} days`,color:"text-orange-700 dark:text-orange-400",bgColor:"bg-orange-50 dark:bg-orange-900/20"}:{text:"Deadline passed",color:"text-red-700 dark:text-red-400",bgColor:"bg-red-100 dark:bg-red-900/30"},P=async(e,t,s)=>{try{let i=Number(s[11])||0,a=[];for(let s=0;s<i;s++)try{let i=await e.call("milestones",t,s);a.push(i)}catch(e){a.push({description:`Milestone ${s+1} - To be defined`,amount:"0",status:0,submittedAt:0,approvedAt:0})}if(a.length>0)return a.map((e,t)=>{try{let i,a,r="",n="0",o=0,l="",d="";if(e&&"object"==typeof e)try{if(e.description&&e.description.includes("To be defined"))r=e.description,n=e.amount||"0",o=e.status||0,i=e.submittedAt||void 0,a=e.approvedAt||void 0;else try{r=void 0!==e.description?String(e.description):void 0!==e[0]?String(e[0]):`Milestone ${t+1}`,n=void 0!==e.amount?String(e.amount):void 0!==e[1]?String(e[1]):"0",o=void 0!==e.status?Number(e.status)||0:void 0!==e[2]&&Number(e[2])||0,void 0!==e.submittedAt&&Number(e.submittedAt)>0?i=1e3*Number(e.submittedAt):void 0!==e[3]&&Number(e[3])>0&&(i=1e3*Number(e[3])),void 0!==e.approvedAt&&Number(e.approvedAt)>0?a=1e3*Number(e.approvedAt):void 0!==e[4]&&Number(e[4])>0&&(a=1e3*Number(e[4])),void 0!==e.disputeReason?l=String(e.disputeReason):void 0!==e[7]&&(l=String(e[7])),void 0!==e.rejectionReason?d=String(e.rejectionReason):void 0!==e[7]&&(d=String(e[7])),(Number(n)/1e18).toFixed(2)}catch(e){r=`Milestone ${t+1}`,n="0",o=0}}catch(e){r=`Milestone ${t+1}`,n="0",o=0}else r=`Milestone ${t+1}`,n="0",o=0;let c=T(o);return r&&r.includes("To be defined")?c="pending":1===o?c="submitted":2===o?c="approved":3===o?c="disputed":4===o?c="resolved":5===o?c="rejected":0===o?c=a&&a>0?"approved":i&&i>0?"submitted":"pending":0===t&&s[5]&&Number(s[5])>0&&(c="approved"),{description:r,amount:n,status:c,submittedAt:i,approvedAt:a,disputeReason:l,rejectionReason:d}}catch(e){return{description:`Milestone ${t+1}`,amount:"0",status:"pending"}}});return[]}catch(e){return[]}},R=async()=>{v(!0);try{let s=t(l.oB.SECUREFLOW_ESCROW,d.f),i=await s.call("nextEscrowId"),a=Number(i),r=[];if(a>1)for(let t=1;t<a;t++)try{let i=await s.call("getEscrowSummary",t),a=i[0].toLowerCase()===e.address?.toLowerCase(),n=i[1].toLowerCase()===e.address?.toLowerCase();if(a||n){let e={id:t.toString(),payer:i[0],beneficiary:i[1],isClient:a,isFreelancer:n,token:i[7],totalAmount:i[4].toString(),releasedAmount:i[5].toString(),status:A(Number(i[3])),createdAt:1e3*Number(i[10]),duration:Number(i[8])-Number(i[10]),milestones:await P(s,t,i),projectDescription:i[13]||""};r.push(e)}}catch(e){continue}h(r)}catch(e){s({title:"Failed to load escrows",description:"Could not fetch your escrows from the blockchain",variant:"destructive"})}finally{v(!1)}},S=async(i,a)=>{try{let r=t(l.oB.SECUREFLOW_ESCROW,d.f);if(!r)return;k(`${i}-${a}`),await r.send("disputeMilestone",i,a,"Disputed by client"),s({title:"Milestone Disputed",description:"A dispute has been opened for this milestone"});let n=p.find(e=>e.id===i),o=n?.beneficiary;m((0,c.A0)("disputed",i,a,{reason:"Disputed by client",clientName:e.address.slice(0,6)+"..."+e.address.slice(-4)}),e.address||void 0,o),await new Promise(e=>setTimeout(e,2e3)),await R()}catch(e){s({title:"Dispute Failed",description:"Could not open dispute. Please try again.",variant:"destructive"})}finally{k(null)}},M=async i=>{try{let a=t(l.oB.SECUREFLOW_ESCROW,d.f);if(!a)return;k(i),await a.send("startWork",i),s({title:"Work Started",description:"You have started work on this escrow"});let r=p.find(e=>e.id===i),n=r?.beneficiary;m((0,c.xg)("work_started",i,{projectTitle:p.find(e=>e.id===i)?.projectDescription||`Project #${i}`,freelancerName:e.address.slice(0,6)+"..."+e.address.slice(-4)}),e.address||void 0,n),await new Promise(e=>setTimeout(e,2e3)),await R()}catch(e){s({title:"Start Work Failed",description:"Could not start work. Please try again.",variant:"destructive"})}finally{k(null)}},F=async e=>{try{let i=t(l.oB.SECUREFLOW_ESCROW,d.f);if(!i)return;k(e),await i.send("disputeMilestone",e,0,"General dispute"),s({title:"Dispute Opened",description:"A dispute has been opened for this escrow"}),await new Promise(e=>setTimeout(e,2e3)),await R()}catch(e){s({title:"Dispute Failed",description:"Could not open dispute. Please try again.",variant:"destructive"})}finally{k(null)}},$=async(i,a)=>{try{let r;let n=p.find(e=>e.id===i);if(!n||n.payer.toLowerCase()!==e.address?.toLowerCase()){s({title:"Access Denied",description:"Only the job creator can approve milestones",variant:"destructive"});return}k(`${i}-${a}`);let o=t(l.oB.SECUREFLOW_ESCROW,d.f);if(!o)return;s({title:"Approving milestone...",description:"Please confirm the transaction in your wallet"});let u=await o.send("approveMilestone","no-value",i,a),h=0;for(;h<30;){try{if(r=await window.ethereum.request({method:"eth_getTransactionReceipt",params:[u]}))break}catch(e){}await new Promise(e=>setTimeout(e,2e3)),h++}if(!r)throw Error("Transaction timeout - please check the blockchain explorer");if("0x1"===r.status){s({title:"Milestone Approved!",description:"Payment has been sent to the freelancer"});let t=n.beneficiary;m((0,c.A0)("approved",i,a,{clientName:e.address.slice(0,6)+"..."+e.address.slice(-4),projectTitle:n.projectDescription||`Project #${i}`}),e.address||void 0,t),await new Promise(e=>setTimeout(e,3e3));let r=n.milestones[a];Number.parseFloat(r.amount),await R(),window.dispatchEvent(new CustomEvent("milestoneApproved")),setTimeout(()=>{window.location.reload()},1e3)}else throw Error("Transaction failed on blockchain")}catch(e){s({title:"Approval Failed",description:e.message||"Failed to approve milestone",variant:"destructive"})}finally{k(null)}},D=async(i,a,r)=>{try{let n;let o=p.find(e=>e.id===i);if(!o||o.payer.toLowerCase()!==e.address?.toLowerCase()){s({title:"Access Denied",description:"Only the job creator can reject milestones",variant:"destructive"});return}k(`${i}-${a}`);let c=t(l.oB.SECUREFLOW_ESCROW,d.f);if(!c)return;s({title:"Rejecting milestone...",description:"Please confirm the transaction in your wallet"});let u=await c.send("rejectMilestone","no-value",i,a,r),m=0;for(;m<30;){try{if(n=await window.ethereum.request({method:"eth_getTransactionReceipt",params:[u]}))break}catch(e){}await new Promise(e=>setTimeout(e,2e3)),m++}if(!n)throw Error("Transaction timeout - please check the blockchain explorer");if("0x1"===n.status)s({title:"Milestone Rejected",description:"The freelancer has been notified and can resubmit"}),await R(),setTimeout(()=>{window.location.reload()},1e3);else throw Error("Transaction failed on blockchain")}catch(e){s({title:"Rejection Failed",description:e.message||"Failed to reject milestone",variant:"destructive"})}finally{k(null)}};return e.isConnected?b?(0,i.jsx)(es,{isConnected:e.isConnected}):(p.filter(e=>"completed"===e.status),p.reduce((e,t)=>e+Number.parseFloat(t.totalAmount)/1e18,0).toFixed(2),e.isConnected)?b?(0,i.jsx)("div",{className:"min-h-screen py-12",children:(0,i.jsxs)("div",{className:"container mx-auto px-4",children:[(0,i.jsx)(w,{}),(0,i.jsx)(es,{isConnected:e.isConnected})]})}):(0,i.jsx)("div",{className:"min-h-screen py-12",children:(0,i.jsxs)("div",{className:"container mx-auto px-4",children:[(0,i.jsx)(w,{}),(0,i.jsx)(g,{escrows:p}),0===p.length?(0,i.jsxs)(r.Zp,{className:"glass border-muted p-12 text-center",children:[(0,i.jsx)(f.A,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground opacity-50"}),(0,i.jsx)("h3",{className:"text-xl font-bold mb-2",children:"No Escrows Found"}),(0,i.jsx)("p",{className:"text-muted-foreground",children:"You don't have any escrows yet. Create one to get started."})]}):(0,i.jsx)("div",{className:"space-y-6",children:p.map((e,t)=>(0,i.jsx)(et,{escrow:e,index:t,expandedEscrow:j,submittingMilestone:N===e.id?"true":"false",onToggleExpanded:()=>y(j===e.id?null:e.id),onApproveMilestone:$,onRejectMilestone:(e,t)=>{D(e,t,"No reason provided")},onDisputeMilestone:S,onStartWork:M,onDispute:F,calculateDaysLeft:C,getDaysLeftMessage:E},e.id))})]})}):(0,i.jsx)("div",{className:"min-h-screen py-12",children:(0,i.jsxs)("div",{className:"container mx-auto px-4",children:[(0,i.jsx)(w,{}),(0,i.jsxs)(r.Zp,{className:"glass border-primary/20 p-12 text-center max-w-md",children:[(0,i.jsx)(x.A,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground"}),(0,i.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Connect Your Wallet"}),(0,i.jsx)("p",{className:"text-muted-foreground",children:"Connect your wallet to view your escrows and manage milestones."})]})]})}):(0,i.jsx)("div",{className:"min-h-screen flex items-center justify-center gradient-mesh",children:(0,i.jsxs)(r.Zp,{className:"glass border-primary/20 p-12 text-center max-w-md",children:[(0,i.jsx)(x.A,{className:"h-16 w-16 mx-auto mb-4 text-muted-foreground"}),(0,i.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Wallet Not Connected"}),(0,i.jsx)("p",{className:"text-muted-foreground mb-6",children:"Please connect your wallet to view your escrows"})]})})}},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},61242:(e,t,s)=>{"use strict";s.d(t,{Cf:()=>m,Es:()=>h,L3:()=>x,c7:()=>p,lG:()=>l,rr:()=>f,zM:()=>d});var i=s(28625),a=s(64996),r=s(52316),n=s(5818),o=s(36761);let l=r.bL,d=r.l9,c=r.ZL;r.bm;let u=a.forwardRef(({className:e,...t},s)=>(0,i.jsx)(r.hJ,{ref:s,className:(0,o.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));u.displayName=r.hJ.displayName;let m=a.forwardRef(({className:e,children:t,...s},a)=>(0,i.jsxs)(c,{children:[(0,i.jsx)(u,{}),(0,i.jsxs)(r.UC,{ref:a,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] rounded-2xl",e),...s,children:[t,(0,i.jsxs)(r.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,i.jsx)(n.A,{className:"h-4 w-4"}),(0,i.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));m.displayName=r.UC.displayName;let p=({className:e,...t})=>(0,i.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});p.displayName="DialogHeader";let h=({className:e,...t})=>(0,i.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});h.displayName="DialogFooter";let x=a.forwardRef(({className:e,...t},s)=>(0,i.jsx)(r.hE,{ref:s,className:(0,o.cn)("text-lg font-semibold leading-none tracking-tight",e),...t}));x.displayName=r.hE.displayName;let f=a.forwardRef(({className:e,...t},s)=>(0,i.jsx)(r.VY,{ref:s,className:(0,o.cn)("text-sm text-muted-foreground",e),...t}));f.displayName=r.VY.displayName},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},71671:(e,t,s)=>{Promise.resolve().then(s.bind(s,53483))},74075:e=>{"use strict";e.exports=require("zlib")},77598:e=>{"use strict";e.exports=require("node:crypto")},79344:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});let i=(0,s(33922).A)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},93683:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});let i=(0,s(33922).A)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]])},94735:e=>{"use strict";e.exports=require("events")},95649:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});let i=(0,s(33922).A)("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]])}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),i=t.X(0,[521,316,56],()=>s(19819));module.exports=i})();